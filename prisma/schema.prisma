// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         String   @id @default(uuid())
  email      String?
  fullName   String?  @map("full_name")
  username   String?
  avatarUrl  String?  @map("avatar_url")
  telegramId BigInt?  @unique @map("telegram_id")
  isAdmin    Boolean  @default(false) @map("is_admin")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  ownedProjects  Project[]       @relation("ProjectOwner")
  projectMembers ProjectMember[]
  posts          Post[]
  publications   Publication[]

  @@map("users")
}

model Project {
  id          String   @id @default(uuid())
  name        String
  description String?
  ownerId     String   @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  owner        User            @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members      ProjectMember[]
  channels     Channel[]
  publications Publication[]

  @@map("projects")
}

model ProjectMember {
  id        String          @id @default(uuid())
  projectId String          @map("project_id")
  userId    String          @map("user_id")
  role      ProjectRole     @default(VIEWER)
  createdAt DateTime        @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@map("project_members")
}

model Channel {
  id                String      @id @default(uuid())
  projectId         String      @map("project_id")
  socialMedia       SocialMedia @map("social_media")
  name              String
  channelIdentifier String      @map("channel_identifier")
  credentials       String      @default("{}") // Store as JSON string in SQLite
  isActive          Boolean     @default(true) @map("is_active")
  createdAt         DateTime    @default(now()) @map("created_at")
  updatedAt         DateTime    @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  posts   Post[]

  @@map("channels")
}

model Publication {
  id         String     @id @default(uuid())
  projectId  String     @map("project_id")
  authorId   String?    @map("author_id")
  title      String?
  content    String
  mediaFiles String     @default("[]") @map("media_files")
  tags       String?
  status     PostStatus @default(DRAFT)
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  author  User?   @relation(fields: [authorId], references: [id], onDelete: SetNull)
  posts   Post[]

  @@map("publications")
}

model Post {
  id            String       @id @default(uuid())
  publicationId String?      @map("publication_id")
  channelId     String       @map("channel_id")
  authorId      String?      @map("author_id")
  content       String?
  socialMedia   String       @map("social_media") // Kept as String for flexibility or could link to Channel's socialMedia
  postType      PostType     @map("post_type")
  title         String?
  description   String?
  authorComment String?      @map("author_comment")
  tags          String? // Store as comma-separated or JSON string
  mediaFiles    String       @default("[]") @map("media_files")
  postDate      DateTime?    @map("post_date")
  status        PostStatus   @default(DRAFT)
  scheduledAt   DateTime?    @map("scheduled_at")
  publishedAt   DateTime?    @map("published_at")
  meta          String       @default("{}")
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")

  publication Publication? @relation(fields: [publicationId], references: [id], onDelete: Cascade)
  channel     Channel      @relation(fields: [channelId], references: [id], onDelete: Cascade)
  author      User?        @relation(fields: [authorId], references: [id], onDelete: SetNull)

  @@map("posts")
}

enum ProjectRole {
  OWNER
  ADMIN
  EDITOR
  VIEWER
}

enum SocialMedia {
  TELEGRAM
  INSTAGRAM
  VK
  YOUTUBE
  TIKTOK
  X
  FACEBOOK
  LINKEDIN
  SITE
}

enum PostType {
  POST
  ARTICLE
  NEWS
  VIDEO
  SHORT
  STORY
}

enum PostStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
  FAILED
}
